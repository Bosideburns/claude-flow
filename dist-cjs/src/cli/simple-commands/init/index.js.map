{"version":3,"sources":["../../../../../src/cli/simple-commands/init/index.js"],"sourcesContent":["// init/index.js - Initialize Claude Code integration files\nimport { printSuccess, printError, printWarning, exit } from '../../utils.js';\nimport { existsSync } from 'fs';\nimport process from 'process';\nimport { spawn, execSync } from 'child_process';\nimport { promisify } from 'util';\n\n// Helper to replace Deno.Command\nfunction runCommand(command, args, options = {}) {\n  return new Promise((resolve, reject) => {\n    const child = spawn(command, args, {\n      cwd: options.cwd,\n      env: { ...process.env, ...options.env },\n      stdio: options.stdout === 'inherit' ? 'inherit' : 'pipe'\n    });\n    \n    let stdout = '';\n    let stderr = '';\n    \n    if (options.stdout !== 'inherit') {\n      child.stdout.on('data', (data) => { stdout += data; });\n      child.stderr.on('data', (data) => { stderr += data; });\n    }\n    \n    child.on('close', (code) => {\n      if (code === 0) {\n        resolve({ success: true, code, stdout, stderr });\n      } else {\n        reject(new Error(`Command failed with exit code ${code}`));\n      }\n    });\n    \n    child.on('error', reject);\n  });\n}\nimport { createLocalExecutable } from './executable-wrapper.js';\nimport { createSparcStructureManually } from './sparc-structure.js';\nimport { createClaudeSlashCommands } from './claude-commands/slash-commands.js';\nimport { createOptimizedClaudeSlashCommands } from './claude-commands/optimized-slash-commands.js';\n// execSync imported above as execSyncOriginal\\nconst execSync = execSyncOriginal;\nimport { promises as fs } from 'fs';\nimport { copyTemplates } from './template-copier.js';\nimport { copyRevisedTemplates, validateTemplatesExist } from './copy-revised-templates.js';\nimport { copyAgentFiles, createAgentDirectories, validateAgentSystem, copyCommandFiles } from './agent-copier.js';\nimport { showInitHelp } from './help.js';\nimport { batchInitCommand, batchInitFromConfig, validateBatchOptions } from './batch-init.js';\nimport { ValidationSystem, runFullValidation } from './validation/index.js';\nimport { RollbackSystem, createAtomicOperation } from './rollback/index.js';\nimport {\n  createEnhancedClaudeMd,\n  createEnhancedSettingsJson,\n  createWrapperScript,\n  createCommandDoc,\n  createHelperScript,\n  COMMAND_STRUCTURE,\n} from './templates/enhanced-templates.js';\nimport { createOptimizedSparcClaudeMd } from './templates/claude-md.js';\nimport { getIsolatedNpxEnv } from '../../../utils/npx-isolated-cache.js';\nimport { updateGitignore, needsGitignoreUpdate } from './gitignore-updater.js';\nimport {\n  createFullClaudeMd,\n  createSparcClaudeMd,\n  createMinimalClaudeMd,\n} from './templates/claude-md.js';\nimport {\n  createVerificationClaudeMd,\n  createVerificationSettingsJson,\n} from './templates/verification-claude-md.js';\nimport {\n  createFullMemoryBankMd,\n  createMinimalMemoryBankMd,\n} from './templates/memory-bank-md.js';\nimport {\n  createFullCoordinationMd,\n  createMinimalCoordinationMd,\n} from './templates/coordination-md.js';\nimport { createAgentsReadme, createSessionsReadme } from './templates/readme-files.js';\nimport { \n  initializeHiveMind, \n  getHiveMindStatus,\n  rollbackHiveMindInit\n} from './hive-mind-init.js';\n\n/**\n * Check if Claude Code CLI is installed\n */\nfunction isClaudeCodeInstalled() {\n  try {\n    execSync('which claude', { stdio: 'ignore' });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Set up MCP servers in Claude Code\n */\nasync function setupMcpServers(dryRun = false) {\n  console.log('\\n🔌 Setting up MCP servers for Claude Code...');\n\n  const servers = [\n    {\n      name: 'claude-flow',\n      command: 'npx claude-flow@alpha mcp start',\n      description: 'Claude Flow MCP server with swarm orchestration (alpha)',\n    },\n    {\n      name: 'ruv-swarm',\n      command: 'npx ruv-swarm mcp start',\n      description: 'ruv-swarm MCP server for enhanced coordination',\n    },\n    {\n      name: 'flow-nexus',\n      command: 'npx flow-nexus@latest mcp start',\n      description: 'Flow Nexus Complete MCP server for advanced AI orchestration',\n    },\n    {\n      name: 'agentic-payments',\n      command: 'npx agentic-payments@latest mcp',\n      description: 'Agentic Payments MCP server for autonomous agent payment authorization',\n    },\n  ];\n\n  for (const server of servers) {\n    try {\n      if (!dryRun) {\n        console.log(`  🔄 Adding ${server.name}...`);\n        execSync(`claude mcp add ${server.name} ${server.command}`, { stdio: 'inherit' });\n        console.log(`  ✅ Added ${server.name} - ${server.description}`);\n      } else {\n        console.log(`  [DRY RUN] Would add ${server.name} - ${server.description}`);\n      }\n    } catch (err) {\n      console.log(`  ⚠️  Failed to add ${server.name}: ${err.message}`);\n      console.log(\n        `     You can add it manually with: claude mcp add ${server.name} ${server.command}`,\n      );\n    }\n  }\n\n  if (!dryRun) {\n    console.log('\\n  📋 Verifying MCP servers...');\n    try {\n      execSync('claude mcp list', { stdio: 'inherit' });\n    } catch (err) {\n      console.log('  ⚠️  Could not verify MCP servers');\n    }\n  }\n}\n\n/**\n * Create statusline script content (embedded fallback for binary builds)\n */\nfunction createStatuslineScript() {\n  return `#!/bin/bash\n\n# Claude Code Status Line with Claude-Flow Integration\n# Displays model, directory, git branch, and real-time swarm metrics\n\n# Read JSON input from stdin\nINPUT=$(cat)\nMODEL=$(echo \"$INPUT\" | jq -r '.model.display_name // \"Claude\"')\nCWD=$(echo \"$INPUT\" | jq -r '.workspace.current_dir // .cwd')\nDIR=$(basename \"$CWD\")\n\n# Replace claude-code-flow with branded name\nif [ \"$DIR\" = \"claude-code-flow\" ]; then\n  DIR=\"🌊 Claude Flow\"\nfi\n\n# Get git branch\nBRANCH=$(cd \"$CWD\" 2>/dev/null && git branch --show-current 2>/dev/null)\n\n# Start building statusline\necho -ne \"\\\\033[1m$MODEL\\\\033[0m in \\\\033[36m$DIR\\\\033[0m\"\n[ -n \"$BRANCH\" ] && echo -ne \" on \\\\033[33m⎇ $BRANCH\\\\033[0m\"\n\n# Claude-Flow integration\nFLOW_DIR=\"$CWD/.claude-flow\"\n\nif [ -d \"$FLOW_DIR\" ]; then\n  echo -ne \" │\"\n\n  # Swarm Configuration & Topology\n  if [ -f \"$FLOW_DIR/swarm-config.json\" ]; then\n    STRATEGY=$(jq -r '.defaultStrategy // empty' \"$FLOW_DIR/swarm-config.json\" 2>/dev/null)\n    if [ -n \"$STRATEGY\" ]; then\n      case \"$STRATEGY\" in\n        \"balanced\") TOPO_ICON=\"⚡mesh\" ;;\n        \"conservative\") TOPO_ICON=\"⚡hier\" ;;\n        \"aggressive\") TOPO_ICON=\"⚡ring\" ;;\n        *) TOPO_ICON=\"⚡$STRATEGY\" ;;\n      esac\n      echo -ne \" \\\\033[35m$TOPO_ICON\\\\033[0m\"\n\n      AGENT_COUNT=$(jq -r '.agentProfiles | length' \"$FLOW_DIR/swarm-config.json\" 2>/dev/null)\n      if [ -n \"$AGENT_COUNT\" ] && [ \"$AGENT_COUNT\" != \"null\" ] && [ \"$AGENT_COUNT\" -gt 0 ]; then\n        echo -ne \"  \\\\033[35m🤖 $AGENT_COUNT\\\\033[0m\"\n      fi\n    fi\n  fi\n\n  # Real-time System Metrics\n  if [ -f \"$FLOW_DIR/metrics/system-metrics.json\" ]; then\n    LATEST=$(jq -r '.[-1]' \"$FLOW_DIR/metrics/system-metrics.json\" 2>/dev/null)\n\n    if [ -n \"$LATEST\" ] && [ \"$LATEST\" != \"null\" ]; then\n      MEM_PERCENT=$(echo \"$LATEST\" | jq -r '.memoryUsagePercent // 0' | awk '{printf \"%.0f\", $1}')\n      if [ -n \"$MEM_PERCENT\" ] && [ \"$MEM_PERCENT\" != \"null\" ]; then\n        if [ \"$MEM_PERCENT\" -lt 60 ]; then\n          MEM_COLOR=\"\\\\033[32m\"\n        elif [ \"$MEM_PERCENT\" -lt 80 ]; then\n          MEM_COLOR=\"\\\\033[33m\"\n        else\n          MEM_COLOR=\"\\\\033[31m\"\n        fi\n        echo -ne \"  \\${MEM_COLOR}💾 \\${MEM_PERCENT}%\\\\033[0m\"\n      fi\n\n      CPU_LOAD=$(echo \"$LATEST\" | jq -r '.cpuLoad // 0' | awk '{printf \"%.0f\", $1 * 100}')\n      if [ -n \"$CPU_LOAD\" ] && [ \"$CPU_LOAD\" != \"null\" ]; then\n        if [ \"$CPU_LOAD\" -lt 50 ]; then\n          CPU_COLOR=\"\\\\033[32m\"\n        elif [ \"$CPU_LOAD\" -lt 75 ]; then\n          CPU_COLOR=\"\\\\033[33m\"\n        else\n          CPU_COLOR=\"\\\\033[31m\"\n        fi\n        echo -ne \"  \\${CPU_COLOR}⚙ \\${CPU_LOAD}%\\\\033[0m\"\n      fi\n    fi\n  fi\n\n  # Performance Metrics\n  if [ -f \"$FLOW_DIR/metrics/task-metrics.json\" ]; then\n    METRICS=$(jq -r '\n      (map(select(.success == true)) | length) as $successful |\n      (length) as $total |\n      (if $total > 0 then ($successful / $total * 100) else 0 end) as $success_rate |\n      (map(.duration // 0) | add / length) as $avg_duration |\n      (reverse | reduce .[] as $task (0; if $task.success == true then . + 1 else 0 end)) as $streak |\n      { success_rate: $success_rate, avg_duration: $avg_duration, streak: $streak, total: $total } | @json\n    ' \"$FLOW_DIR/metrics/task-metrics.json\" 2>/dev/null)\n\n    if [ -n \"$METRICS\" ] && [ \"$METRICS\" != \"null\" ]; then\n      SUCCESS_RATE=$(echo \"$METRICS\" | jq -r '.success_rate // 0' | awk '{printf \"%.0f\", $1}')\n      TOTAL_TASKS=$(echo \"$METRICS\" | jq -r '.total // 0')\n\n      if [ -n \"$SUCCESS_RATE\" ] && [ \"$TOTAL_TASKS\" -gt 0 ]; then\n        if [ \"$SUCCESS_RATE\" -gt 80 ]; then\n          SUCCESS_COLOR=\"\\\\033[32m\"\n        elif [ \"$SUCCESS_RATE\" -ge 60 ]; then\n          SUCCESS_COLOR=\"\\\\033[33m\"\n        else\n          SUCCESS_COLOR=\"\\\\033[31m\"\n        fi\n        echo -ne \"  \\${SUCCESS_COLOR}🎯 \\${SUCCESS_RATE}%\\\\033[0m\"\n      fi\n\n      AVG_TIME=$(echo \"$METRICS\" | jq -r '.avg_duration // 0')\n      if [ -n \"$AVG_TIME\" ] && [ \"$TOTAL_TASKS\" -gt 0 ]; then\n        if [ $(echo \"$AVG_TIME < 60\" | bc -l 2>/dev/null || echo 0) -eq 1 ]; then\n          TIME_STR=$(echo \"$AVG_TIME\" | awk '{printf \"%.1fs\", $1}')\n        elif [ $(echo \"$AVG_TIME < 3600\" | bc -l 2>/dev/null || echo 0) -eq 1 ]; then\n          TIME_STR=$(echo \"$AVG_TIME\" | awk '{printf \"%.1fm\", $1/60}')\n        else\n          TIME_STR=$(echo \"$AVG_TIME\" | awk '{printf \"%.1fh\", $1/3600}')\n        fi\n        echo -ne \"  \\\\033[36m⏱️  $TIME_STR\\\\033[0m\"\n      fi\n\n      STREAK=$(echo \"$METRICS\" | jq -r '.streak // 0')\n      if [ -n \"$STREAK\" ] && [ \"$STREAK\" -gt 0 ]; then\n        echo -ne \"  \\\\033[91m🔥 $STREAK\\\\033[0m\"\n      fi\n    fi\n  fi\n\n  # Active Tasks\n  if [ -d \"$FLOW_DIR/tasks\" ]; then\n    TASK_COUNT=$(find \"$FLOW_DIR/tasks\" -name \"*.json\" -type f 2>/dev/null | wc -l)\n    if [ \"$TASK_COUNT\" -gt 0 ]; then\n      echo -ne \"  \\\\033[36m📋 $TASK_COUNT\\\\033[0m\"\n    fi\n  fi\nfi\n\necho\n`;\n}\n\nexport async function initCommand(subArgs, flags) {\n  // Show help if requested\n  if (flags.help || flags.h || subArgs.includes('--help') || subArgs.includes('-h')) {\n    showInitHelp();\n    return;\n  }\n\n  // Check for verification flags first\n  const hasVerificationFlags = subArgs.includes('--verify') || subArgs.includes('--pair') || \n                               flags.verify || flags.pair;\n  \n  // Handle Flow Nexus minimal init\n  if (flags['flow-nexus']) {\n    return await flowNexusMinimalInit(flags, subArgs);\n  }\n\n  // Default to enhanced Claude Flow v2 init unless other modes are specified\n  // Use --basic flag for old behavior, or verification flags for verification mode\n  if (!flags.basic && !flags.minimal && !flags.sparc && !hasVerificationFlags) {\n    return await enhancedClaudeFlowInit(flags, subArgs);\n  }\n\n  // Check for validation and rollback commands\n  if (subArgs.includes('--validate') || subArgs.includes('--validate-only')) {\n    return handleValidationCommand(subArgs, flags);\n  }\n\n  if (subArgs.includes('--rollback')) {\n    return handleRollbackCommand(subArgs, flags);\n  }\n\n  if (subArgs.includes('--list-backups')) {\n    return handleListBackups(subArgs, flags);\n  }\n\n  // Check for batch operations\n  const batchInitFlag = flags['batch-init'] || subArgs.includes('--batch-init');\n  const configFlag = flags.config || subArgs.includes('--config');\n\n  if (batchInitFlag || configFlag) {\n    return handleBatchInit(subArgs, flags);\n  }\n\n  // Check if enhanced initialization is requested\n  const useEnhanced = subArgs.includes('--enhanced') || subArgs.includes('--safe');\n\n  if (useEnhanced) {\n    return enhancedInitCommand(subArgs, flags);\n  }\n\n  // Parse init options\n  const initForce = subArgs.includes('--force') || subArgs.includes('-f') || flags.force;\n  const initMinimal = subArgs.includes('--minimal') || subArgs.includes('-m') || flags.minimal;\n  const initSparc = flags.roo || (subArgs && subArgs.includes('--roo')); // SPARC only with --roo flag\n  const initDryRun = subArgs.includes('--dry-run') || subArgs.includes('-d') || flags.dryRun;\n  const initOptimized = initSparc && initForce; // Use optimized templates when both flags are present\n  const selectedModes = flags.modes ? flags.modes.split(',') : null; // Support selective mode initialization\n  \n  // Check for verification and pair programming flags\n  const initVerify = subArgs.includes('--verify') || flags.verify;\n  const initPair = subArgs.includes('--pair') || flags.pair;\n\n  // Get the actual working directory (where the command was run from)\n  // Use PWD environment variable which preserves the original directory\n  const workingDir = process.env.PWD || cwd();\n  console.log(`📁 Initializing in: ${workingDir}`);\n\n  // Change to the working directory to ensure all file operations happen there\n  try {\n    process.chdir(workingDir);\n  } catch (err) {\n    printWarning(`Could not change to directory ${workingDir}: ${err.message}`);\n  }\n\n  try {\n    printSuccess('Initializing Claude Code integration files...');\n\n    // Check if files already exist in the working directory\n    const files = ['CLAUDE.md', 'memory-bank.md', 'coordination.md'];\n    const existingFiles = [];\n\n    for (const file of files) {\n      try {\n        await fs.stat(`${workingDir}/${file}`);\n        existingFiles.push(file);\n      } catch {\n        // File doesn't exist, which is what we want\n      }\n    }\n\n    if (existingFiles.length > 0 && !initForce) {\n      printWarning(`The following files already exist: ${existingFiles.join(', ')}`);\n      console.log('Use --force to overwrite existing files');\n      return;\n    }\n\n    // Use template copier to copy all template files\n    const templateOptions = {\n      sparc: initSparc,\n      minimal: initMinimal,\n      optimized: initOptimized,\n      dryRun: initDryRun,\n      force: initForce,\n      selectedModes: selectedModes,\n      verify: initVerify,\n      pair: initPair,\n    };\n\n    // If verification flags are set, always use generated templates for CLAUDE.md and settings.json\n    if (initVerify || initPair) {\n      console.log('  📁 Creating verification-focused configuration...');\n      \n      // Create verification CLAUDE.md\n      if (!initDryRun) {\n        const { createVerificationClaudeMd, createVerificationSettingsJson } = await import('./templates/verification-claude-md.js');\n        await fs.writeFile(`${workingDir}/CLAUDE.md`, createVerificationClaudeMd(), 'utf8');\n        \n        // Create .claude directory and settings\n        await fs.mkdir(`${workingDir}/.claude`, { recursive: true });\n        await fs.writeFile(`${workingDir}/.claude/settings.json`, createVerificationSettingsJson(), 'utf8');\n        console.log('  ✅ Created verification-focused CLAUDE.md and settings.json');\n      } else {\n        console.log('  [DRY RUN] Would create verification-focused CLAUDE.md and settings.json');\n      }\n      \n      // Copy other template files from repository if available\n      const validation = validateTemplatesExist();\n      if (validation.valid) {\n        const revisedResults = await copyRevisedTemplates(workingDir, {\n          force: initForce,\n          dryRun: initDryRun,\n          verbose: false,\n          sparc: initSparc\n        });\n      }\n      \n      // Also create standard memory and coordination files\n      const copyResults = await copyTemplates(workingDir, {\n        ...templateOptions,\n        skipClaudeMd: true,  // Don't overwrite the verification CLAUDE.md\n        skipSettings: true   // Don't overwrite the verification settings.json\n      });\n      \n    } else {\n      // Standard template copying logic\n      const validation = validateTemplatesExist();\n      if (validation.valid) {\n        console.log('  📁 Copying revised template files...');\n        const revisedResults = await copyRevisedTemplates(workingDir, {\n          force: initForce,\n          dryRun: initDryRun,\n          verbose: true,\n          sparc: initSparc\n        });\n\n        if (revisedResults.success) {\n          console.log(`  ✅ Copied ${revisedResults.copiedFiles.length} template files`);\n          if (revisedResults.skippedFiles.length > 0) {\n            console.log(`  ⏭️  Skipped ${revisedResults.skippedFiles.length} existing files`);\n          }\n        } else {\n          console.log('  ⚠️  Some template files could not be copied:');\n          revisedResults.errors.forEach(err => console.log(`    - ${err}`));\n        }\n      } else {\n        // Fall back to generated templates\n        console.log('  ⚠️  Revised templates not available, using generated templates');\n        const copyResults = await copyTemplates(workingDir, templateOptions);\n\n        if (!copyResults.success) {\n          printError('Failed to copy templates:');\n          copyResults.errors.forEach(err => console.log(`  ❌ ${err}`));\n          return;\n        }\n      }\n    }\n\n    // Agent setup moved to end of function where execution is guaranteed\n\n    // Directory structure is created by template copier\n\n    // SPARC files are created by template copier when --sparc flag is used\n\n    // Memory README files and persistence database are created by template copier\n\n    // Create local claude-flow@alpha executable wrapper\n    if (!initDryRun) {\n      await createLocalExecutable(workingDir);\n    } else {\n      console.log('  [DRY RUN] Would create local claude-flow@alpha executable wrapper');\n    }\n\n    // SPARC initialization\n    if (initSparc) {\n      console.log('\\n🚀 Initializing SPARC development environment...');\n\n      if (initDryRun) {\n        console.log('  [DRY RUN] Would run: npx -y create-sparc init --force');\n        console.log('  [DRY RUN] Would create SPARC environment with all modes');\n        console.log(\n          '  [DRY RUN] Would create Claude slash commands' +\n            (initOptimized ? ' (Batchtools-optimized)' : ''),\n        );\n        if (selectedModes) {\n          console.log(\n            `  [DRY RUN] Would create commands for selected modes: ${selectedModes.join(', ')}`,\n          );\n        }\n      } else {\n        // Check if create-sparc exists and run it\n        let sparcInitialized = false;\n        try {\n          // Use isolated NPX cache to prevent concurrent conflicts\n          console.log('  🔄 Running: npx -y create-sparc init --force');\n          const createSparcResult = await runCommand('npx', ['-y', 'create-sparc', 'init', '--force'], {\n            cwd: workingDir,\n            stdout: 'inherit',\n            stderr: 'inherit',\n            env: getIsolatedNpxEnv({\n              PWD: workingDir,\n            }),\n          });\n\n          if (createSparcResult.success) {\n            console.log('  ✅ SPARC environment initialized successfully');\n            sparcInitialized = true;\n          } else {\n            printWarning('create-sparc failed, creating basic SPARC structure manually...');\n\n            // Fallback: create basic SPARC structure manually\n            await createSparcStructureManually();\n            sparcInitialized = true; // Manual creation still counts as initialized\n          }\n        } catch (err) {\n          printWarning('create-sparc not available, creating basic SPARC structure manually...');\n\n          // Fallback: create basic SPARC structure manually\n          await createSparcStructureManually();\n          sparcInitialized = true; // Manual creation still counts as initialized\n        }\n\n        // Always create Claude slash commands after SPARC initialization\n        if (sparcInitialized) {\n          try {\n            if (initOptimized) {\n              await createOptimizedClaudeSlashCommands(workingDir, selectedModes);\n            } else {\n              await createClaudeSlashCommands(workingDir);\n            }\n          } catch (err) {\n            // Legacy slash command creation - silently skip if it fails\n            // SPARC slash commands are already created successfully above\n          }\n        }\n      }\n    }\n\n    if (initDryRun) {\n      printSuccess(\"🔍 Dry run completed! Here's what would be created:\");\n      console.log('\\n📋 Summary of planned initialization:');\n      console.log(\n        `  • Configuration: ${initOptimized ? 'Batchtools-optimized SPARC' : initSparc ? 'SPARC-enhanced' : 'Standard'}`,\n      );\n      console.log(\n        `  • Template type: ${initOptimized ? 'Optimized for parallel processing' : 'Standard'}`,\n      );\n      console.log('  • Core files: CLAUDE.md, memory-bank.md, coordination.md');\n      console.log('  • Directory structure: memory/, coordination/, .claude/');\n      console.log('  • Local executable: ./claude-flow@alpha');\n      if (initSparc) {\n        console.log(\n          `  • Claude Code slash commands: ${selectedModes ? selectedModes.length : 'All'} SPARC mode commands`,\n        );\n        console.log('  • SPARC environment with all development modes');\n      }\n      if (initOptimized) {\n        console.log('  • Batchtools optimization: Enabled for parallel processing');\n        console.log('  • Performance enhancements: Smart batching, concurrent operations');\n      }\n      console.log('\\n🚀 To proceed with initialization, run the same command without --dry-run');\n    } else {\n      printSuccess('🎉 Claude Code integration files initialized successfully!');\n\n      if (initOptimized) {\n        console.log('\\n⚡ Batchtools Optimization Enabled!');\n        console.log('  • Parallel processing capabilities activated');\n        console.log('  • Performance improvements: 250-500% faster operations');\n        console.log('  • Smart batching and concurrent operations available');\n      }\n\n      console.log('\\n📋 What was created:');\n      console.log(\n        `  ✅ CLAUDE.md (${initOptimized ? 'Batchtools-optimized' : initSparc ? 'SPARC-enhanced' : 'Standard configuration'})`,\n      );\n      console.log(\n        `  ✅ memory-bank.md (${initOptimized ? 'With parallel processing' : 'Standard memory system'})`,\n      );\n      console.log(\n        `  ✅ coordination.md (${initOptimized ? 'Enhanced with batchtools' : 'Standard coordination'})`,\n      );\n      console.log('  ✅ Directory structure with memory/ and coordination/');\n      console.log('  ✅ Local executable at ./claude-flow@alpha');\n      console.log('  ✅ Persistence database at memory/claude-flow@alpha-data.json');\n      console.log('  ✅ Agent system with 64 specialized agents in .claude/agents/');\n\n      if (initSparc) {\n        const modeCount = selectedModes ? selectedModes.length : '20+';\n        console.log(`  ✅ Claude Code slash commands (${modeCount} SPARC modes)`);\n        console.log('  ✅ Complete SPARC development environment');\n      }\n\n      console.log('\\n🚀 Next steps:');\n      console.log('1. Review and customize the generated files for your project');\n      console.log(\"2. Run './claude-flow@alpha start' to begin the orchestration system\");\n      console.log(\"3. Use './claude-flow@alpha' instead of 'npx claude-flow@alpha' for all commands\");\n      console.log(\"4. Use 'claude --dangerously-skip-permissions' for unattended operation\");\n\n      if (initSparc) {\n        console.log(\n          '5. Use Claude Code slash commands: /sparc, /sparc-architect, /sparc-tdd, etc.',\n        );\n        console.log(\"6. Explore SPARC modes with './claude-flow@alpha sparc modes'\");\n        console.log('7. Try TDD workflow with \\'./claude-flow@alpha sparc tdd \"your task\"\\'');\n\n        if (initOptimized) {\n          console.log('8. Use batchtools commands: /batchtools, /performance for optimization');\n          console.log('9. Enable parallel processing with --parallel flags');\n          console.log(\"10. Monitor performance with './claude-flow@alpha performance monitor'\");\n        }\n      }\n\n      // Update .gitignore\n      const gitignoreResult = await updateGitignore(workingDir, initForce, initDryRun);\n      if (gitignoreResult.success) {\n        if (!initDryRun) {\n          console.log(`  ✅ ${gitignoreResult.message}`);\n        } else {\n          console.log(`  ${gitignoreResult.message}`);\n        }\n      } else {\n        console.log(`  ⚠️  ${gitignoreResult.message}`);\n      }\n\n      console.log('\\n💡 Tips:');\n      console.log(\"  • Type '/' in Claude Code to see all available slash commands\");\n      console.log(\"  • Use './claude-flow@alpha status' to check system health\");\n      console.log(\"  • Store important context with './claude-flow@alpha memory store'\");\n\n      if (initOptimized) {\n        console.log('  • Use --parallel flags for concurrent operations');\n        console.log('  • Enable batch processing for multiple related tasks');\n        console.log('  • Monitor performance with real-time metrics');\n      }\n\n      // Initialize hive-mind system for standard init\n      console.log('\\n🧠 Initializing basic hive-mind system...');\n      try {\n        const hiveMindOptions = {\n          config: {\n            integration: {\n              claudeCode: { enabled: isClaudeCodeInstalled() },\n              mcpTools: { enabled: true }\n            },\n            monitoring: { enabled: false } // Basic setup for standard init\n          }\n        };\n        \n        const hiveMindResult = await initializeHiveMind(workingDir, hiveMindOptions, false);\n        \n        if (hiveMindResult.success) {\n          console.log('  ✅ Basic hive-mind system initialized');\n          console.log('  💡 Use \"npx claude-flow@alpha hive-mind\" for advanced features');\n        } else {\n          console.log(`  ⚠️  Hive-mind setup skipped: ${hiveMindResult.error}`);\n        }\n      } catch (err) {\n        console.log(`  ⚠️  Hive-mind setup skipped: ${err.message}`);\n      }\n\n      // Check for Claude Code and set up MCP servers (always enabled by default)\n      if (!initDryRun && isClaudeCodeInstalled()) {\n        console.log('\\n🔍 Claude Code CLI detected!');\n        const skipMcp = subArgs && subArgs.includes && subArgs.includes('--skip-mcp');\n\n        if (!skipMcp) {\n          await setupMcpServers(initDryRun);\n        } else {\n          console.log('  ℹ️  Skipping MCP setup (--skip-mcp flag used)');\n        }\n      } else if (!initDryRun && !isClaudeCodeInstalled()) {\n        console.log('\\n⚠️  Claude Code CLI not detected!');\n        console.log('  📥 Install with: npm install -g @anthropic-ai/claude-code');\n        console.log('  📋 Then add MCP servers manually with:');\n        console.log('     claude mcp add claude-flow npx claude-flow@alpha mcp start');\n        console.log('     claude mcp add ruv-swarm npx ruv-swarm mcp start');\n        console.log('     claude mcp add flow-nexus npx flow-nexus@latest mcp start');\n        console.log('     claude mcp add agentic-payments npx agentic-payments@latest mcp');\n      }\n    }\n  } catch (err) {\n    printError(`Failed to initialize files: ${err.message}`);\n  }\n}\n\n// Handle batch initialization\nasync function handleBatchInit(subArgs, flags) {\n  try {\n    // Options parsing from flags and subArgs\n    const options = {\n      parallel: !flags['no-parallel'] && flags.parallel !== false,\n      sparc: flags.sparc || flags.s,\n      minimal: flags.minimal || flags.m,\n      force: flags.force || flags.f,\n      maxConcurrency: flags['max-concurrent'] || 5,\n      progressTracking: true,\n      template: flags.template,\n      environments: flags.environments\n        ? flags.environments.split(',').map((env) => env.trim())\n        : ['dev'],\n    };\n\n    // Validate options\n    const validationErrors = validateBatchOptions(options);\n    if (validationErrors.length > 0) {\n      printError('Batch options validation failed:');\n      validationErrors.forEach((error) => console.error(`  - ${error}`));\n      return;\n    }\n\n    // Config file mode\n    if (flags.config) {\n      const configFile = flags.config;\n      printSuccess(`Loading batch configuration from: ${configFile}`);\n      const results = await batchInitFromConfig(configFile, options);\n      if (results) {\n        printSuccess('Batch initialization from config completed');\n      }\n      return;\n    }\n\n    // Batch init mode\n    if (flags['batch-init']) {\n      const projectsString = flags['batch-init'];\n      const projects = projectsString.split(',').map((project) => project.trim());\n\n      if (projects.length === 0) {\n        printError('No projects specified for batch initialization');\n        return;\n      }\n\n      printSuccess(`Initializing ${projects.length} projects in batch mode`);\n      const results = await batchInitCommand(projects, options);\n\n      if (results) {\n        const successful = results.filter((r) => r.success).length;\n        const failed = results.filter((r) => !r.success).length;\n\n        if (failed === 0) {\n          printSuccess(`All ${successful} projects initialized successfully`);\n        } else {\n          printWarning(`${successful} projects succeeded, ${failed} failed`);\n        }\n      }\n      return;\n    }\n\n    printError('No batch operation specified. Use --batch-init <projects> or --config <file>');\n  } catch (err) {\n    printError(`Batch initialization failed: ${err.message}`);\n  }\n}\n\n/**\n * Enhanced initialization command with validation and rollback\n */\nasync function enhancedInitCommand(subArgs, flags) {\n  console.log('🛡️  Starting enhanced initialization with validation and rollback...');\n\n  // Store parameters to avoid scope issues in async context\n  const args = subArgs || [];\n  const options = flags || {};\n\n  // Get the working directory\n  const workingDir = process.env.PWD || process.cwd();\n\n  // Initialize systems\n  const rollbackSystem = new RollbackSystem(workingDir);\n  const validationSystem = new ValidationSystem(workingDir);\n\n  let atomicOp = null;\n\n  try {\n    // Parse options\n    const initOptions = {\n      force: args.includes('--force') || args.includes('-f') || options.force,\n      minimal: args.includes('--minimal') || args.includes('-m') || options.minimal,\n      sparc: args.includes('--sparc') || args.includes('-s') || options.sparc,\n      skipPreValidation: args.includes('--skip-pre-validation'),\n      skipBackup: args.includes('--skip-backup'),\n      validateOnly: args.includes('--validate-only'),\n    };\n\n    // Phase 1: Pre-initialization validation\n    if (!initOptions.skipPreValidation) {\n      console.log('\\n🔍 Phase 1: Pre-initialization validation...');\n      const preValidation = await validationSystem.validatePreInit(initOptions);\n\n      if (!preValidation.success) {\n        printError('Pre-initialization validation failed:');\n        preValidation.errors.forEach((error) => console.error(`  ❌ ${error}`));\n        return;\n      }\n\n      if (preValidation.warnings.length > 0) {\n        printWarning('Pre-initialization warnings:');\n        preValidation.warnings.forEach((warning) => console.warn(`  ⚠️  ${warning}`));\n      }\n\n      printSuccess('Pre-initialization validation passed');\n    }\n\n    // Stop here if validation-only mode\n    if (options.validateOnly) {\n      console.log('\\n✅ Validation-only mode completed');\n      return;\n    }\n\n    // Phase 2: Create backup\n    if (!options.skipBackup) {\n      console.log('\\n💾 Phase 2: Creating backup...');\n      const backupResult = await rollbackSystem.createPreInitBackup();\n\n      if (!backupResult.success) {\n        printError('Backup creation failed:');\n        backupResult.errors.forEach((error) => console.error(`  ❌ ${error}`));\n        return;\n      }\n    }\n\n    // Phase 3: Initialize with atomic operations\n    console.log('\\n🔧 Phase 3: Atomic initialization...');\n    atomicOp = createAtomicOperation(rollbackSystem, 'enhanced-init');\n\n    const atomicBegin = await atomicOp.begin();\n    if (!atomicBegin) {\n      printError('Failed to begin atomic operation');\n      return;\n    }\n\n    // Perform initialization steps with checkpoints\n    await performInitializationWithCheckpoints(rollbackSystem, options, workingDir, dryRun);\n\n    // Phase 4: Post-initialization validation\n    console.log('\\n✅ Phase 4: Post-initialization validation...');\n    const postValidation = await validationSystem.validatePostInit();\n\n    if (!postValidation.success) {\n      printError('Post-initialization validation failed:');\n      postValidation.errors.forEach((error) => console.error(`  ❌ ${error}`));\n\n      // Attempt automatic rollback\n      console.log('\\n🔄 Attempting automatic rollback...');\n      await atomicOp.rollback();\n      printWarning('Initialization rolled back due to validation failure');\n      return;\n    }\n\n    // Phase 5: Configuration validation\n    console.log('\\n🔧 Phase 5: Configuration validation...');\n    const configValidation = await validationSystem.validateConfiguration();\n\n    if (configValidation.warnings.length > 0) {\n      printWarning('Configuration warnings:');\n      configValidation.warnings.forEach((warning) => console.warn(`  ⚠️  ${warning}`));\n    }\n\n    // Phase 6: Health checks\n    console.log('\\n🏥 Phase 6: System health checks...');\n    const healthChecks = await validationSystem.runHealthChecks();\n\n    if (healthChecks.warnings.length > 0) {\n      printWarning('Health check warnings:');\n      healthChecks.warnings.forEach((warning) => console.warn(`  ⚠️  ${warning}`));\n    }\n\n    // Commit atomic operation\n    await atomicOp.commit();\n\n    // Generate and display validation report\n    const fullValidation = await runFullValidation(workingDir, {\n      postInit: true,\n      skipPreInit: options.skipPreValidation,\n    });\n\n    console.log('\\n📊 Validation Report:');\n    console.log(fullValidation.report);\n\n    printSuccess('🎉 Enhanced initialization completed successfully!');\n    console.log('\\n✨ Your SPARC environment is fully validated and ready to use');\n  } catch (error) {\n    printError(`Enhanced initialization failed: ${error.message}`);\n\n    // Attempt rollback if atomic operation is active\n    if (atomicOp && !atomicOp.completed) {\n      console.log('\\n🔄 Performing emergency rollback...');\n      try {\n        await atomicOp.rollback();\n        printWarning('Emergency rollback completed');\n      } catch (rollbackError) {\n        printError(`Rollback also failed: ${rollbackError.message}`);\n      }\n    }\n  }\n}\n\n/**\n * Handle validation commands\n */\nasync function handleValidationCommand(subArgs, flags) {\n  const workingDir = process.env.PWD || process.cwd();\n\n  console.log('🔍 Running validation checks...');\n\n  const options = {\n    skipPreInit: subArgs.includes('--skip-pre-init'),\n    skipConfig: subArgs.includes('--skip-config'),\n    skipModeTest: subArgs.includes('--skip-mode-test'),\n    postInit: !subArgs.includes('--pre-init-only'),\n  };\n\n  try {\n    const validationResults = await runFullValidation(workingDir, options);\n\n    console.log('\\n📊 Validation Results:');\n    console.log(validationResults.report);\n\n    if (validationResults.success) {\n      printSuccess('✅ All validation checks passed');\n    } else {\n      printError('❌ Some validation checks failed');\n      process.exit(1);\n    }\n  } catch (error) {\n    printError(`Validation failed: ${error.message}`);\n    process.exit(1);\n  }\n}\n\n/**\n * Handle rollback commands\n */\nasync function handleRollbackCommand(subArgs, flags) {\n  const workingDir = process.env.PWD || process.cwd();\n  const rollbackSystem = new RollbackSystem(workingDir);\n\n  try {\n    // Check for specific rollback options\n    if (subArgs.includes('--full')) {\n      console.log('🔄 Performing full rollback...');\n      const result = await rollbackSystem.performFullRollback();\n\n      if (result.success) {\n        printSuccess('Full rollback completed successfully');\n      } else {\n        printError('Full rollback failed:');\n        result.errors.forEach((error) => console.error(`  ❌ ${error}`));\n      }\n    } else if (subArgs.includes('--partial')) {\n      const phaseIndex = subArgs.findIndex((arg) => arg === '--phase');\n      if (phaseIndex !== -1 && subArgs[phaseIndex + 1]) {\n        const phase = subArgs[phaseIndex + 1];\n        console.log(`🔄 Performing partial rollback for phase: ${phase}`);\n\n        const result = await rollbackSystem.performPartialRollback(phase);\n\n        if (result.success) {\n          printSuccess(`Partial rollback completed for phase: ${phase}`);\n        } else {\n          printError(`Partial rollback failed for phase: ${phase}`);\n          result.errors.forEach((error) => console.error(`  ❌ ${error}`));\n        }\n      } else {\n        printError('Partial rollback requires --phase <phase-name>');\n      }\n    } else {\n      // Interactive rollback point selection\n      const rollbackPoints = await rollbackSystem.listRollbackPoints();\n\n      if (rollbackPoints.rollbackPoints.length === 0) {\n        printWarning('No rollback points available');\n        return;\n      }\n\n      console.log('\\n📋 Available rollback points:');\n      rollbackPoints.rollbackPoints.forEach((point, index) => {\n        const date = new Date(point.timestamp).toLocaleString();\n        console.log(`  ${index + 1}. ${point.type} - ${date}`);\n      });\n\n      // For now, rollback to the most recent point\n      const latest = rollbackPoints.rollbackPoints[0];\n      if (latest) {\n        console.log(\n          `\\n🔄 Rolling back to: ${latest.type} (${new Date(latest.timestamp).toLocaleString()})`,\n        );\n        const result = await rollbackSystem.performFullRollback(latest.backupId);\n\n        if (result.success) {\n          printSuccess('Rollback completed successfully');\n        } else {\n          printError('Rollback failed');\n        }\n      }\n    }\n  } catch (error) {\n    printError(`Rollback operation failed: ${error.message}`);\n  }\n}\n\n/**\n * Handle list backups command\n */\nasync function handleListBackups(subArgs, flags) {\n  const workingDir = process.env.PWD || process.cwd();\n  const rollbackSystem = new RollbackSystem(workingDir);\n\n  try {\n    const rollbackPoints = await rollbackSystem.listRollbackPoints();\n\n    console.log('\\n📋 Rollback Points and Backups:');\n\n    if (rollbackPoints.rollbackPoints.length === 0) {\n      console.log('  No rollback points available');\n    } else {\n      console.log('\\n🔄 Rollback Points:');\n      rollbackPoints.rollbackPoints.forEach((point, index) => {\n        const date = new Date(point.timestamp).toLocaleString();\n        console.log(`  ${index + 1}. ${point.type} - ${date} (${point.backupId || 'No backup'})`);\n      });\n    }\n\n    if (rollbackPoints.checkpoints.length > 0) {\n      console.log('\\n📍 Checkpoints:');\n      rollbackPoints.checkpoints.slice(-5).forEach((checkpoint, index) => {\n        const date = new Date(checkpoint.timestamp).toLocaleString();\n        console.log(`  ${index + 1}. ${checkpoint.phase} - ${date} (${checkpoint.status})`);\n      });\n    }\n  } catch (error) {\n    printError(`Failed to list backups: ${error.message}`);\n  }\n}\n\n/**\n * Perform initialization with checkpoints\n */\nasync function performInitializationWithCheckpoints(\n  rollbackSystem,\n  options,\n  workingDir,\n  dryRun = false,\n) {\n  const phases = [\n    { name: 'file-creation', action: () => createInitialFiles(options, workingDir, dryRun) },\n    { name: 'directory-structure', action: () => createDirectoryStructure(workingDir, dryRun) },\n    { name: 'memory-setup', action: () => setupMemorySystem(workingDir, dryRun) },\n    { name: 'coordination-setup', action: () => setupCoordinationSystem(workingDir, dryRun) },\n    { name: 'executable-creation', action: () => createLocalExecutable(workingDir, dryRun) },\n  ];\n\n  if (options.sparc) {\n    phases.push(\n      { name: 'sparc-init', action: () => createSparcStructureManually() },\n      { name: 'claude-commands', action: () => createClaudeSlashCommands(workingDir) },\n    );\n  }\n\n  for (const phase of phases) {\n    console.log(`  🔧 ${phase.name}...`);\n\n    // Create checkpoint before phase\n    await rollbackSystem.createCheckpoint(phase.name, {\n      timestamp: Date.now(),\n      phase: phase.name,\n    });\n\n    try {\n      await phase.action();\n      console.log(`  ✅ ${phase.name} completed`);\n    } catch (error) {\n      console.error(`  ❌ ${phase.name} failed: ${error.message}`);\n      throw error;\n    }\n  }\n}\n\n// Helper functions for atomic initialization\nasync function createInitialFiles(options, workingDir, dryRun = false) {\n  if (!dryRun) {\n    const claudeMd = options.sparc\n      ? createSparcClaudeMd()\n      : options.minimal\n        ? createMinimalClaudeMd()\n        : createFullClaudeMd();\n    await fs.writeFile(`${workingDir}/CLAUDE.md`, claudeMd, 'utf8');\n\n    const memoryBankMd = options.minimal ? createMinimalMemoryBankMd() : createFullMemoryBankMd();\n    await fs.writeFile(`${workingDir}/memory-bank.md`, memoryBankMd, 'utf8');\n\n    const coordinationMd = options.minimal\n      ? createMinimalCoordinationMd()\n      : createFullCoordinationMd();\n    await fs.writeFile(`${workingDir}/coordination.md`, coordinationMd, 'utf8');\n  }\n}\n\nasync function createDirectoryStructure(workingDir, dryRun = false) {\n  const directories = [\n    'memory',\n    'memory/agents',\n    'memory/sessions',\n    'coordination',\n    'coordination/memory_bank',\n    'coordination/subtasks',\n    'coordination/orchestration',\n    '.claude',\n    '.claude/commands',\n    '.claude/logs',\n  ];\n\n  if (!dryRun) {\n    for (const dir of directories) {\n      await fs.mkdir(`${workingDir}/${dir}`, { recursive: true });\n    }\n  }\n}\n\nasync function setupMemorySystem(workingDir, dryRun = false) {\n  if (!dryRun) {\n    const initialData = { agents: [], tasks: [], lastUpdated: Date.now() };\n    await fs.writeFile(\n      `${workingDir}/memory/claude-flow@alpha-data.json`, JSON.stringify(initialData, null, 2), 'utf8'\n    );\n\n    await fs.writeFile(`${workingDir}/memory/agents/README.md`, createAgentsReadme(), 'utf8');\n    await fs.writeFile(`${workingDir}/memory/sessions/README.md`, createSessionsReadme(), 'utf8');\n  }\n}\n\nasync function setupCoordinationSystem(workingDir, dryRun = false) {\n  // Coordination system is already set up by createDirectoryStructure\n  // This is a placeholder for future coordination setup logic\n}\n\n/**\n * Setup monitoring and telemetry for token tracking\n */\nasync function setupMonitoring(workingDir) {\n  console.log('  📈 Configuring token usage tracking...');\n  \n  const fs = await import('fs/promises');\n  const path = await import('path');\n  \n  try {\n    // Create .claude-flow@alpha directory for tracking data\n    const trackingDir = path.join(workingDir, '.claude-flow@alpha');\n    await fs.mkdir(trackingDir, { recursive: true });\n    \n    // Create initial token usage file\n    const tokenUsageFile = path.join(trackingDir, 'token-usage.json');\n    const initialData = {\n      total: 0,\n      input: 0,\n      output: 0,\n      byAgent: {},\n      lastUpdated: new Date().toISOString()\n    };\n    \n    await fs.writeFile(tokenUsageFile, JSON.stringify(initialData, null, 2));\n    printSuccess('  ✓ Created token usage tracking file');\n    \n    // Add telemetry configuration to .claude/settings.json if it exists\n    const settingsPath = path.join(workingDir, '.claude', 'settings.json');\n    try {\n      const settingsContent = await fs.readFile(settingsPath, 'utf8');\n      const settings = JSON.parse(settingsContent);\n      \n      // Add telemetry hook\n      if (!settings.hooks) settings.hooks = {};\n      if (!settings.hooks['post-task']) settings.hooks['post-task'] = [];\n      \n      // Add token tracking hook\n      const tokenTrackingHook = 'npx claude-flow@alpha internal track-tokens --session-id {{session_id}} --tokens {{token_usage}}';\n      if (!settings.hooks['post-task'].includes(tokenTrackingHook)) {\n        settings.hooks['post-task'].push(tokenTrackingHook);\n      }\n      \n      await fs.writeFile(settingsPath, JSON.stringify(settings, null, 2));\n      printSuccess('  ✓ Added token tracking hooks to settings');\n    } catch (err) {\n      console.log('  ⚠️  Could not update settings.json:', err.message);\n    }\n    \n    // Create monitoring configuration\n    const monitoringConfig = {\n      enabled: true,\n      telemetry: {\n        claudeCode: {\n          env: 'CLAUDE_CODE_ENABLE_TELEMETRY',\n          value: '1',\n          description: 'Enable Claude Code OpenTelemetry metrics'\n        }\n      },\n      tracking: {\n        tokens: true,\n        costs: true,\n        agents: true,\n        sessions: true\n      },\n      storage: {\n        location: '.claude-flow@alpha/token-usage.json',\n        format: 'json',\n        rotation: 'monthly'\n      }\n    };\n    \n    const configPath = path.join(trackingDir, 'monitoring.config.json');\n    await fs.writeFile(configPath, JSON.stringify(monitoringConfig, null, 2));\n    printSuccess('  ✓ Created monitoring configuration');\n    \n    // Create shell profile snippet for environment variable\n    const envSnippet = `\n# Claude Flow Token Tracking\n# Add this to your shell profile (.bashrc, .zshrc, etc.)\nexport CLAUDE_CODE_ENABLE_TELEMETRY=1\n\n# Optional: Set custom metrics path\n# export CLAUDE_METRICS_PATH=\"$HOME/.claude/metrics\"\n`;\n    \n    const envPath = path.join(trackingDir, 'env-setup.sh');\n    await fs.writeFile(envPath, envSnippet.trim());\n    printSuccess('  ✓ Created environment setup script');\n    \n    console.log('\\n  📋 To enable Claude Code telemetry:');\n    console.log('     1. Add to your shell profile: export CLAUDE_CODE_ENABLE_TELEMETRY=1');\n    console.log('     2. Or run: source .claude-flow@alpha/env-setup.sh');\n    console.log('\\n  💡 Token usage will be tracked in .claude-flow@alpha/token-usage.json');\n    console.log('     Run: claude-flow@alpha analysis token-usage --breakdown --cost-analysis');\n    \n  } catch (err) {\n    printError(`  Failed to setup monitoring: ${err.message}`);\n  }\n}\n\n/**\n * Enhanced Claude Flow v2.0.0 initialization\n */\nasync function enhancedClaudeFlowInit(flags, subArgs = []) {\n  console.log('🚀 Initializing Claude Flow v2.0.0 with enhanced features...');\n\n  const workingDir = process.cwd();\n  const force = flags.force || flags.f;\n  const dryRun = flags.dryRun || flags['dry-run'] || flags.d;\n  const initSparc = flags.roo || (subArgs && subArgs.includes('--roo')); // SPARC only with --roo flag\n\n  // Store parameters to avoid scope issues in async context\n  const args = subArgs || [];\n  const options = flags || {};\n\n  // Import fs module for Node.js\n  const fs = await import('fs/promises');\n  const { chmod } = fs;\n\n  try {\n    // Check existing files\n    const existingFiles = [];\n    const filesToCheck = [\n      'CLAUDE.md',\n      '.claude/settings.json',\n      '.mcp.json',\n      // Removed claude-flow@alpha.config.json per user request\n    ];\n\n    for (const file of filesToCheck) {\n      if (existsSync(`${workingDir}/${file}`)) {\n        existingFiles.push(file);\n      }\n    }\n\n    if (existingFiles.length > 0 && !force) {\n      printWarning(`The following files already exist: ${existingFiles.join(', ')}`);\n      console.log('Use --force to overwrite existing files');\n      return;\n    }\n\n    // Create CLAUDE.md\n    if (!dryRun) {\n      await fs.writeFile(`${workingDir}/CLAUDE.md`, createOptimizedSparcClaudeMd(), 'utf8');\n      printSuccess('✓ Created CLAUDE.md (Claude Flow v2.0.0 - Optimized)');\n    } else {\n      console.log('[DRY RUN] Would create CLAUDE.md (Claude Flow v2.0.0 - Optimized)');\n    }\n\n    // Create .claude directory structure\n    const claudeDir = `${workingDir}/.claude`;\n    if (!dryRun) {\n      await fs.mkdir(claudeDir, { recursive: true });\n      await fs.mkdir(`${claudeDir}/commands`, { recursive: true });\n      await fs.mkdir(`${claudeDir}/helpers`, { recursive: true });\n      printSuccess('✓ Created .claude directory structure');\n    } else {\n      console.log('[DRY RUN] Would create .claude directory structure');\n    }\n\n    // Create settings.json\n    if (!dryRun) {\n      await fs.writeFile(`${claudeDir}/settings.json`, createEnhancedSettingsJson(), 'utf8');\n      printSuccess('✓ Created .claude/settings.json with hooks and MCP configuration');\n    } else {\n      console.log('[DRY RUN] Would create .claude/settings.json');\n    }\n\n    // Copy statusline script\n    try {\n      let statuslineTemplate;\n      try {\n        // Try to read from templates directory first\n        statuslineTemplate = await fs.readFile(\n          path.join(__dirname, 'templates', 'statusline-command.sh'),\n          'utf8'\n        );\n      } catch {\n        // Fallback to embedded content (for binary builds)\n        statuslineTemplate = createStatuslineScript();\n      }\n\n      if (!dryRun) {\n        await fs.writeFile(`${claudeDir}/statusline-command.sh`, statuslineTemplate, 'utf8');\n        await fs.chmod(`${claudeDir}/statusline-command.sh`, 0o755);\n        printSuccess('✓ Created .claude/statusline-command.sh for enhanced Claude Code statusline');\n      } else {\n        console.log('[DRY RUN] Would create .claude/statusline-command.sh');\n      }\n    } catch (err) {\n      // Not critical, just skip\n      if (!dryRun) {\n        console.log('  ⚠️  Could not create statusline script, skipping...');\n      }\n    }\n\n    // Create settings.local.json with default MCP permissions\n    const settingsLocal = {\n      permissions: {\n        allow: ['mcp__ruv-swarm', 'mcp__claude-flow@alpha', 'mcp__flow-nexus'],\n        deny: [],\n      },\n    };\n\n    if (!dryRun) {\n      await fs.writeFile(\n        `${claudeDir}/settings.local.json`, JSON.stringify(settingsLocal, null, 2, 'utf8'),\n      );\n      printSuccess('✓ Created .claude/settings.local.json with default MCP permissions');\n    } else {\n      console.log(\n        '[DRY RUN] Would create .claude/settings.local.json with default MCP permissions',\n      );\n    }\n\n    // Create .mcp.json at project root for MCP server configuration\n    const mcpConfig = {\n      mcpServers: {\n        'claude-flow@alpha': {\n          command: 'npx',\n          args: ['claude-flow@alpha', 'mcp', 'start'],\n          type: 'stdio',\n        },\n        'ruv-swarm': {\n          command: 'npx',\n          args: ['ruv-swarm@latest', 'mcp', 'start'],\n          type: 'stdio',\n        },\n        'flow-nexus': {\n          command: 'npx',\n          args: ['flow-nexus@latest', 'mcp', 'start'],\n          type: 'stdio',\n        },\n        'agentic-payments': {\n          command: 'npx',\n          args: ['agentic-payments@latest', 'mcp'],\n          type: 'stdio',\n        },\n      },\n    };\n\n    if (!dryRun) {\n      await fs.writeFile(`${workingDir}/.mcp.json`, JSON.stringify(mcpConfig, null, 2, 'utf8'));\n      printSuccess('✓ Created .mcp.json at project root for MCP server configuration');\n    } else {\n      console.log('[DRY RUN] Would create .mcp.json at project root for MCP server configuration');\n    }\n\n    // Removed claude-flow@alpha.config.json creation per user request\n\n    // Create command documentation\n    for (const [category, commands] of Object.entries(COMMAND_STRUCTURE)) {\n      const categoryDir = `${claudeDir}/commands/${category}`;\n\n      if (!dryRun) {\n        await fs.mkdir(categoryDir, { recursive: true });\n\n        // Create category README\n        const categoryReadme = `# ${category.charAt(0).toUpperCase() + category.slice(1)} Commands\n\nCommands for ${category} operations in Claude Flow.\n\n## Available Commands\n\n${commands.map((cmd) => `- [${cmd}](./${cmd}.md)`).join('\\n')}\n`;\n        await fs.writeFile(`${categoryDir}/README.md`, categoryReadme, 'utf8');\n\n        // Create individual command docs\n        for (const command of commands) {\n          const doc = createCommandDoc(category, command);\n          if (doc) {\n            await fs.writeFile(`${categoryDir}/${command}.md`, doc, 'utf8');\n          }\n        }\n\n        console.log(`  ✓ Created ${commands.length} ${category} command docs`);\n      } else {\n        console.log(`[DRY RUN] Would create ${commands.length} ${category} command docs`);\n      }\n    }\n\n    // Create wrapper scripts using the dedicated function\n    if (!dryRun) {\n      await createLocalExecutable(workingDir, dryRun);\n    } else {\n      console.log('[DRY RUN] Would create wrapper scripts');\n    }\n\n    // Create helper scripts\n    const helpers = ['setup-mcp.sh', 'quick-start.sh', 'github-setup.sh', 'github-safe.js', 'standard-checkpoint-hooks.sh', 'checkpoint-manager.sh'];\n    for (const helper of helpers) {\n      if (!dryRun) {\n        const content = createHelperScript(helper);\n        if (content) {\n          await fs.writeFile(`${claudeDir}/helpers/${helper}`, content, 'utf8');\n          await fs.chmod(`${claudeDir}/helpers/${helper}`, 0o755);\n        }\n      }\n    }\n\n    if (!dryRun) {\n      printSuccess(`✓ Created ${helpers.length} helper scripts`);\n    } else {\n      console.log(`[DRY RUN] Would create ${helpers.length} helper scripts`);\n    }\n\n    // Create standard directories from original init\n    const standardDirs = [\n      'memory',\n      'memory/agents',\n      'memory/sessions',\n      'coordination',\n      'coordination/memory_bank',\n      'coordination/subtasks',\n      'coordination/orchestration',\n      '.swarm', // Add .swarm directory for shared memory\n      '.hive-mind', // Add .hive-mind directory for hive-mind system\n      '.claude/checkpoints', // Add checkpoints directory for Git checkpoint system\n    ];\n\n    for (const dir of standardDirs) {\n      if (!dryRun) {\n        await fs.mkdir(`${workingDir}/${dir}`, { recursive: true });\n      }\n    }\n\n    if (!dryRun) {\n      printSuccess('✓ Created standard directory structure');\n\n      // Initialize memory system\n      const initialData = { agents: [], tasks: [], lastUpdated: Date.now() };\n      await fs.writeFile(\n        `${workingDir}/memory/claude-flow@alpha-data.json`, JSON.stringify(initialData, null, 2, 'utf8'),\n      );\n\n      // Create README files\n      await fs.writeFile(`${workingDir}/memory/agents/README.md`, createAgentsReadme(), 'utf8');\n      await fs.writeFile(`${workingDir}/memory/sessions/README.md`, createSessionsReadme(), 'utf8');\n\n      printSuccess('✓ Initialized memory system');\n\n      // Initialize memory database with fallback support\n      try {\n        // Import and initialize FallbackMemoryStore to create the database\n        const { FallbackMemoryStore } = await import('../../../memory/fallback-store.js');\n        const memoryStore = new FallbackMemoryStore();\n        await memoryStore.initialize();\n\n        if (memoryStore.isUsingFallback()) {\n          printSuccess('✓ Initialized memory system (in-memory fallback for npx compatibility)');\n          console.log(\n            '  💡 For persistent storage, install locally: npm install claude-flow@alpha',\n          );\n        } else {\n          printSuccess('✓ Initialized memory database (.swarm/memory.db)');\n        }\n\n        memoryStore.close();\n      } catch (err) {\n        console.log(`  ⚠️  Could not initialize memory system: ${err.message}`);\n        console.log('     Memory will be initialized on first use');\n      }\n\n      // Initialize comprehensive hive-mind system\n      console.log('\\n🧠 Initializing Hive Mind System...');\n      try {\n        const hiveMindOptions = {\n          config: {\n            integration: {\n              claudeCode: { enabled: isClaudeCodeInstalled() },\n              mcpTools: { enabled: true }\n            },\n            monitoring: { enabled: flags.monitoring || false }\n          }\n        };\n        \n        const hiveMindResult = await initializeHiveMind(workingDir, hiveMindOptions, dryRun);\n        \n        if (hiveMindResult.success) {\n          printSuccess(`✓ Hive Mind System initialized with ${hiveMindResult.features.length} features`);\n          \n          // Log individual features\n          hiveMindResult.features.forEach(feature => {\n            console.log(`    • ${feature}`);\n          });\n        } else {\n          console.log(`  ⚠️  Hive Mind initialization failed: ${hiveMindResult.error}`);\n          if (hiveMindResult.rollbackRequired) {\n            console.log('  🔄 Automatic rollback may be required');\n          }\n        }\n      } catch (err) {\n        console.log(`  ⚠️  Could not initialize hive-mind system: ${err.message}`);\n      }\n    }\n\n    // Update .gitignore with Claude Flow entries\n    const gitignoreResult = await updateGitignore(workingDir, force, dryRun);\n    if (gitignoreResult.success) {\n      if (!dryRun) {\n        printSuccess(`✓ ${gitignoreResult.message}`);\n      } else {\n        console.log(gitignoreResult.message);\n      }\n    } else {\n      console.log(`  ⚠️  ${gitignoreResult.message}`);\n    }\n\n    // SPARC initialization (only with --roo flag)\n    let sparcInitialized = false;\n    if (initSparc) {\n      console.log('\\n🚀 Initializing SPARC development environment...');\n      try {\n        // Run create-sparc\n        console.log('  🔄 Running: npx -y create-sparc init --force');\n        execSync('npx -y create-sparc init --force', {\n          cwd: workingDir,\n          stdio: 'inherit',\n        });\n        sparcInitialized = true;\n        printSuccess('✅ SPARC environment initialized successfully');\n      } catch (err) {\n        console.log(`  ⚠️  Could not run create-sparc: ${err.message}`);\n        console.log('     SPARC features will be limited to basic functionality');\n      }\n    }\n\n    // Create Claude slash commands for SPARC\n    if (sparcInitialized && !dryRun) {\n      console.log('\\n📝 Creating Claude Code slash commands...');\n      await createClaudeSlashCommands(workingDir);\n    }\n\n    // Check for Claude Code and set up MCP servers (always enabled by default)\n    if (!dryRun && isClaudeCodeInstalled()) {\n      console.log('\\n🔍 Claude Code CLI detected!');\n      const skipMcp =\n        (options && options['skip-mcp']) ||\n        (subArgs && subArgs.includes && subArgs.includes('--skip-mcp'));\n\n      if (!skipMcp) {\n        await setupMcpServers(dryRun);\n      } else {\n        console.log('  ℹ️  Skipping MCP setup (--skip-mcp flag used)');\n        console.log('\\n  📋 To add MCP servers manually:');\n        console.log('     claude mcp add claude-flow npx claude-flow@alpha mcp start');\n        console.log('     claude mcp add ruv-swarm npx ruv-swarm@latest mcp start');\n        console.log('     claude mcp add flow-nexus npx flow-nexus@latest mcp start');\n        console.log('     claude mcp add agentic-payments npx agentic-payments@latest mcp');\n        console.log('\\n  💡 MCP servers are defined in .mcp.json (project scope)');\n      }\n    } else if (!dryRun && !isClaudeCodeInstalled()) {\n      console.log('\\n⚠️  Claude Code CLI not detected!');\n      console.log('\\n  📥 To install Claude Code:');\n      console.log('     npm install -g @anthropic-ai/claude-code');\n      console.log('\\n  📋 After installing, add MCP servers:');\n      console.log('     claude mcp add claude-flow@alpha npx claude-flow@alpha mcp start');\n      console.log('     claude mcp add ruv-swarm npx ruv-swarm@latest mcp start');\n      console.log('     claude mcp add flow-nexus npx flow-nexus@latest mcp start');\n      console.log('     claude mcp add agentic-payments npx agentic-payments@latest mcp');\n      console.log('\\n  💡 MCP servers are defined in .mcp.json (project scope)');\n    }\n\n    // Create agent directories and copy all agent files\n    console.log('\\n🤖 Setting up agent system...');\n    if (!dryRun) {\n      await createAgentDirectories(workingDir, dryRun);\n      const agentResult = await copyAgentFiles(workingDir, {\n        force: force,\n        dryRun: dryRun\n      });\n      \n      if (agentResult.success) {\n        await validateAgentSystem(workingDir);\n        \n        // Copy command files including Flow Nexus commands\n        console.log('\\n📚 Setting up command system...');\n        const commandResult = await copyCommandFiles(workingDir, {\n          force: force,\n          dryRun: dryRun\n        });\n        \n        if (commandResult.success) {\n          console.log('✅ ✓ Command system setup complete with Flow Nexus integration');\n        } else {\n          console.log('⚠️  Command system setup failed:', commandResult.error);\n        }\n        \n        console.log('✅ ✓ Agent system setup complete with 64 specialized agents');\n      } else {\n        console.log('⚠️  Agent system setup failed:', agentResult.error);\n      }\n    } else {\n      console.log('  [DRY RUN] Would create agent system with 64 specialized agents');\n    }\n\n    // Optional: Setup monitoring and telemetry\n    const enableMonitoring = flags.monitoring || flags['enable-monitoring'];\n    if (enableMonitoring && !dryRun) {\n      console.log('\\n📊 Setting up monitoring and telemetry...');\n      await setupMonitoring(workingDir);\n    }\n    \n    // Final instructions with hive-mind status\n    console.log('\\n🎉 Claude Flow v2.0.0 initialization complete!');\n    \n    // Display hive-mind status\n    const hiveMindStatus = getHiveMindStatus(workingDir);\n    console.log('\\n🧠 Hive Mind System Status:');\n    console.log(`  Configuration: ${hiveMindStatus.configured ? '✅ Ready' : '❌ Missing'}`);\n    console.log(`  Database: ${hiveMindStatus.database === 'sqlite' ? '✅ SQLite' : hiveMindStatus.database === 'fallback' ? '⚠️ JSON Fallback' : '❌ Not initialized'}`);\n    console.log(`  Directory Structure: ${hiveMindStatus.directories ? '✅ Created' : '❌ Missing'}`);\n    \n    console.log('\\n📚 Quick Start:');\n    if (isClaudeCodeInstalled()) {\n      console.log('1. View available commands: ls .claude/commands/');\n      console.log('2. Start a swarm: npx claude-flow@alpha swarm \"your objective\" --claude');\n      console.log('3. Use hive-mind: npx claude-flow@alpha hive-mind spawn \"command\" --claude');\n      console.log('4. Use MCP tools in Claude Code for enhanced coordination');\n      if (hiveMindStatus.configured) {\n        console.log('5. Initialize first swarm: npx claude-flow@alpha hive-mind init');\n      }\n    } else {\n      console.log('1. Install Claude Code: npm install -g @anthropic-ai/claude-code');\n      console.log('2. Add MCP servers (see instructions above)');\n      console.log('3. View available commands: ls .claude/commands/');\n      console.log('4. Start a swarm: npx claude-flow@alpha swarm \"your objective\" --claude');\n      console.log('5. Use hive-mind: npx claude-flow@alpha hive-mind spawn \"command\" --claude');\n      if (hiveMindStatus.configured) {\n        console.log('6. Initialize first swarm: npx claude-flow@alpha hive-mind init');\n      }\n    }\n    console.log('\\n💡 Tips:');\n    console.log('• Check .claude/commands/ for detailed documentation');\n    console.log('• Use --help with any command for options');\n    console.log('• Run commands with --claude flag for best Claude Code integration');\n    console.log('• Enable GitHub integration with .claude/helpers/github-setup.sh');\n    console.log('• Git checkpoints are automatically enabled in settings.json');\n    console.log('• Use .claude/helpers/checkpoint-manager.sh for easy rollback');\n  } catch (err) {\n    printError(`Failed to initialize Claude Flow v2.0.0: ${err.message}`);\n    \n    // Attempt hive-mind rollback if it was partially initialized\n    try {\n      const hiveMindStatus = getHiveMindStatus(workingDir);\n      if (hiveMindStatus.directories || hiveMindStatus.configured) {\n        console.log('\\n🔄 Attempting hive-mind system rollback...');\n        const rollbackResult = await rollbackHiveMindInit(workingDir);\n        if (rollbackResult.success) {\n          console.log('  ✅ Hive-mind rollback completed');\n        } else {\n          console.log(`  ⚠️  Hive-mind rollback failed: ${rollbackResult.error}`);\n        }\n      }\n    } catch (rollbackErr) {\n      console.log(`  ⚠️  Rollback error: ${rollbackErr.message}`);\n    }\n  }\n}\n\n/**\n * Flow Nexus minimal initialization - only creates Flow Nexus CLAUDE.md, commands, and agents\n */\nasync function flowNexusMinimalInit(flags, subArgs) {\n  console.log('🌐 Flow Nexus: Initializing minimal setup...');\n  \n  try {\n    const force = flags.force || flags.f;\n    \n    // Import functions we need\n    const { createFlowNexusClaudeMd } = await import('./templates/claude-md.js');\n    const { promises: fs } = await import('fs');\n    \n    // Create Flow Nexus CLAUDE.md\n    console.log('📝 Creating Flow Nexus CLAUDE.md...');\n    const flowNexusClaudeMd = createFlowNexusClaudeMd();\n    await fs.writeFile('CLAUDE.md', flowNexusClaudeMd);\n    console.log('  ✅ Created CLAUDE.md with Flow Nexus integration');\n    \n    // Create .claude/commands/flow-nexus directory and copy commands\n    console.log('📁 Setting up Flow Nexus commands...');\n    await fs.mkdir('.claude/commands/flow-nexus', { recursive: true });\n    \n    // Copy Flow Nexus command files\n    const { fileURLToPath } = await import('url');\n    const { dirname, join } = await import('path');\n    const __filename = fileURLToPath(import.meta.url);\n    const __dirname = dirname(__filename);\n    const sourceCommandsDir = join(__dirname, '../../../../.claude/commands/flow-nexus');\n    try {\n      const commandFiles = await fs.readdir(sourceCommandsDir);\n      let copiedCommands = 0;\n      \n      for (const file of commandFiles) {\n        if (file.endsWith('.md')) {\n          const sourcePath = `${sourceCommandsDir}/${file}`;\n          const destPath = `.claude/commands/flow-nexus/${file}`;\n          const content = await fs.readFile(sourcePath, 'utf8');\n          await fs.writeFile(destPath, content);\n          copiedCommands++;\n        }\n      }\n      \n      console.log(`  ✅ Copied ${copiedCommands} Flow Nexus command files`);\n    } catch (err) {\n      console.log('  ⚠️  Could not copy Flow Nexus commands:', err.message);\n    }\n    \n    // Create .claude/agents/flow-nexus directory and copy agents\n    console.log('🤖 Setting up Flow Nexus agents...');\n    await fs.mkdir('.claude/agents/flow-nexus', { recursive: true });\n    \n    // Copy Flow Nexus agent files\n    const sourceAgentsDir = join(__dirname, '../../../../.claude/agents/flow-nexus');\n    try {\n      const agentFiles = await fs.readdir(sourceAgentsDir);\n      let copiedAgents = 0;\n      \n      for (const file of agentFiles) {\n        if (file.endsWith('.md')) {\n          const sourcePath = `${sourceAgentsDir}/${file}`;\n          const destPath = `.claude/agents/flow-nexus/${file}`;\n          const content = await fs.readFile(sourcePath, 'utf8');\n          await fs.writeFile(destPath, content);\n          copiedAgents++;\n        }\n      }\n      \n      console.log(`  ✅ Copied ${copiedAgents} Flow Nexus agent files`);\n    } catch (err) {\n      console.log('  ⚠️  Could not copy Flow Nexus agents:', err.message);\n    }\n    \n    console.log('\\n🎉 Flow Nexus minimal initialization complete!');\n    console.log('📚 Created: CLAUDE.md with Flow Nexus documentation');\n    console.log('📁 Created: .claude/commands/flow-nexus/ directory with command documentation');\n    console.log('🤖 Created: .claude/agents/flow-nexus/ directory with specialized agents');\n    console.log('');\n    console.log('💡 Quick Start:');\n    console.log('  1. Register: mcp__flow-nexus__user_register({ email, password })');\n    console.log('  2. Login: mcp__flow-nexus__user_login({ email, password })');\n    console.log('  3. Deploy: mcp__flow-nexus__swarm_init({ topology: \"mesh\", maxAgents: 5 })');\n    console.log('');\n    console.log('🔗 Use Flow Nexus MCP tools in Claude Code for full functionality');\n    \n  } catch (err) {\n    console.log(`❌ Flow Nexus initialization failed: ${err.message}`);\n    console.log('Stack trace:', err.stack);\n    process.exit(1);\n  }\n}\n"],"names":["printSuccess","printError","printWarning","existsSync","process","spawn","execSync","runCommand","command","args","options","Promise","resolve","reject","child","cwd","env","stdio","stdout","stderr","on","data","code","success","Error","createLocalExecutable","createSparcStructureManually","createClaudeSlashCommands","createOptimizedClaudeSlashCommands","promises","fs","copyTemplates","copyRevisedTemplates","validateTemplatesExist","copyAgentFiles","createAgentDirectories","validateAgentSystem","copyCommandFiles","showInitHelp","batchInitCommand","batchInitFromConfig","validateBatchOptions","ValidationSystem","runFullValidation","RollbackSystem","createAtomicOperation","createEnhancedSettingsJson","createCommandDoc","createHelperScript","COMMAND_STRUCTURE","createOptimizedSparcClaudeMd","getIsolatedNpxEnv","updateGitignore","createFullClaudeMd","createSparcClaudeMd","createMinimalClaudeMd","createFullMemoryBankMd","createMinimalMemoryBankMd","createFullCoordinationMd","createMinimalCoordinationMd","createAgentsReadme","createSessionsReadme","initializeHiveMind","getHiveMindStatus","rollbackHiveMindInit","isClaudeCodeInstalled","setupMcpServers","dryRun","console","log","servers","name","description","server","err","message","createStatuslineScript","initCommand","subArgs","flags","help","h","includes","hasVerificationFlags","verify","pair","flowNexusMinimalInit","basic","minimal","sparc","enhancedClaudeFlowInit","handleValidationCommand","handleRollbackCommand","handleListBackups","batchInitFlag","configFlag","config","handleBatchInit","useEnhanced","enhancedInitCommand","initForce","force","initMinimal","initSparc","roo","initDryRun","initOptimized","selectedModes","modes","split","initVerify","initPair","workingDir","PWD","chdir","files","existingFiles","file","stat","push","length","join","templateOptions","optimized","createVerificationClaudeMd","createVerificationSettingsJson","writeFile","mkdir","recursive","validation","valid","revisedResults","verbose","copyResults","skipClaudeMd","skipSettings","copiedFiles","skippedFiles","errors","forEach","sparcInitialized","createSparcResult","modeCount","gitignoreResult","hiveMindOptions","integration","claudeCode","enabled","mcpTools","monitoring","hiveMindResult","error","skipMcp","parallel","s","m","f","maxConcurrency","progressTracking","template","environments","map","trim","validationErrors","configFile","results","projectsString","projects","project","successful","filter","r","failed","rollbackSystem","validationSystem","atomicOp","initOptions","skipPreValidation","skipBackup","validateOnly","preValidation","validatePreInit","warnings","warning","warn","backupResult","createPreInitBackup","atomicBegin","begin","performInitializationWithCheckpoints","postValidation","validatePostInit","rollback","configValidation","validateConfiguration","healthChecks","runHealthChecks","commit","fullValidation","postInit","skipPreInit","report","completed","rollbackError","skipConfig","skipModeTest","validationResults","exit","result","performFullRollback","phaseIndex","findIndex","arg","phase","performPartialRollback","rollbackPoints","listRollbackPoints","point","index","date","Date","timestamp","toLocaleString","type","latest","backupId","checkpoints","slice","checkpoint","status","phases","action","createInitialFiles","createDirectoryStructure","setupMemorySystem","setupCoordinationSystem","createCheckpoint","now","claudeMd","memoryBankMd","coordinationMd","directories","dir","initialData","agents","tasks","lastUpdated","JSON","stringify","setupMonitoring","path","trackingDir","tokenUsageFile","total","input","output","byAgent","toISOString","settingsPath","settingsContent","readFile","settings","parse","hooks","tokenTrackingHook","monitoringConfig","telemetry","value","tracking","tokens","costs","sessions","storage","location","format","rotation","configPath","envSnippet","envPath","d","chmod","filesToCheck","claudeDir","statuslineTemplate","__dirname","settingsLocal","permissions","allow","deny","mcpConfig","mcpServers","category","commands","Object","entries","categoryDir","categoryReadme","charAt","toUpperCase","cmd","doc","helpers","helper","content","standardDirs","FallbackMemoryStore","memoryStore","initialize","isUsingFallback","close","features","feature","rollbackRequired","agentResult","commandResult","enableMonitoring","hiveMindStatus","configured","database","rollbackResult","rollbackErr","createFlowNexusClaudeMd","flowNexusClaudeMd","fileURLToPath","dirname","__filename","url","sourceCommandsDir","commandFiles","readdir","copiedCommands","endsWith","sourcePath","destPath","sourceAgentsDir","agentFiles","copiedAgents","stack"],"mappings":"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"}